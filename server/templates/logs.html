<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Logs de Conexão – Segurança FNAF</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <h1>Logs de Conexão</h1>

  <div class="monitor-grid" id="log-container"></div>

  <p style="margin-top:2rem;">
    <a href="{{ url_for('index') }}" style="color:#a020f0; text-decoration:underline;">
      ← Voltar à Central de Segurança
    </a>
  </p>

  <script>
    const container = document.getElementById('log-container');
    const initial   = {{ records|tojson }};
    let logsCount   = initial.length;

    function renderLog(r) {
      const f = document.createElement('div');
      f.className = 'frame';
      f.innerHTML = `
        <div class="info" style="flex-direction: column; align-items: flex-start;">
          <div><strong>Recebido em:</strong> ${r.received_at}</div>
          <div><strong>IP Cliente:</strong> ${r.client_ip}</div>
          <div><strong>User-Agent:</strong> ${r.user_agent}</div>
          <div><strong>Data (payload):</strong> ${r.date}</div>
          <div><strong>Hora (payload):</strong> ${r.time}</div>
          <div><strong>Distância:</strong> ${r.distance} cm</div>
          <div><strong>Câmera:</strong> ${r.camera}</div>
        </div>
      `;
      return f;
    }

    // renderiza os logs iniciais (reversa)
    initial.slice().reverse().forEach(r => container.appendChild(renderLog(r)));

    async function fetchLogs() {
      try {
        const resp = await fetch('{{ url_for("api_logs") }}');
        const all  = await resp.json();
        if (all.length > logsCount) {
          const novos = all.slice(logsCount);
          novos.reverse().forEach(r => {
            container.insertBefore(renderLog(r), container.firstChild);
            logsCount++;
          });
        }
      } catch (e) {
        console.error('Erro ao buscar logs:', e);
      }
    }

    setInterval(fetchLogs, 2000);
  </script>
</body>
</html>
